# 개략적인 규모 추정

### 응답지연 값

* L1 캐시 참조 : 1ns
* 분기 예측 오류 : 3ns
  * 분기 예측 : 파이프라인을 통한 명령 실행 중 조건 분기 명령의 실행이 종료될 때까지 대기하지 않고 분기를 예측 실행해 파이프라인 성능 저하를 최소화하는 기술
  * 분기 예측 오류란 이러한 분기 예측이 실패했을 때 예측 실행한 명령어의 내용을 취소하고 원 상태로 복구하는 것을 말한다.
* L2 캐시 참조 : 4ns
* mutex lock/unlock : 17ns
* 주 메모리 참조 : 100ns
* Zippy로 1kb 압축 : 2000ns
* 일반 상용 네트워크 상에서 2KB 전송 : 44ns
* 메모리에서 1MB 순차적 읽기 : 3000ns
* 동일 데이터 센터 내에서 패킷 왕복 지연시간 : 500000ns
* SSD에서 1MB 순차적 읽기 : 49000ns
* 디스크 탐색 : 2000000ns = 2ms
* 디스크에서 1MB 순차적 읽기 : 825000ns
* 캘리포니아에서 네덜란드까지의 패킷 왕복 지연시간 : 150000000ns = 150ms

* 결론
  * 메모리가 디스크보다 훨씬 빠르다.
  * 디스크 탐색은 되도록 피한다.
  * 단순한 압축 알고리즘은 빠르다.
  * 데이터를 인터넷으로 전송할 때는 압축하는 것이 좋다.
  * 데이터 센터는 보통 여러 지역에 분산되어 있어서 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

### 가용성에 관계된 수치들

* 고가용성(high availability) : 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력
  * 퍼센트로 표현
  * 100%는 시스템이 단 한 번도 중단된 적 없음을 의미한다.
  * 대부분의 서비스는 99%~100% 사이의 값을 갖는다.
* SLA(Service Level Agreement)
  * 서비스 사업자와 고객 사이에 맺어진 합의
  * 이 합의에는 서비스 사업자가 제공하는 서비스의 가용시간(uptime)이 공식적으로 기술되어 있다.
  * 가용시간은 관습적으로 숫자 9를 사용해 표시한다.

### 예제 : 트위터 QPS와 저장소 요구량 추정

* 가정
  * 월간 활동한 사용자 : 3억 명
  * 50% 사용자가 트위터를 매일 사용한다.
  * 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
  * 미디어를 포함하는 트윗은 10% 정도다.
  * 데이터는 5년간 보관된다.
* 추정
  * QPS(Query Per Second) : (3억 명) * (50%) * (2트윗) / (24시간) / (3600초) = 약 3500개
  * 최대 QPS : 2*QPS = 약 7000개
  * 미디어 저장을 위한 저장소 요구량
    * 평균 트윗 크기
      * tweet_id : 64byte
      * 텍스트 : 140byte
      * 미디어 : 1MB
    * 미디어 저장소 요구량 : (3억 명) * (50%) * (2트윗) * (10%) * (1MB) = 30TB / 일
    * 5년간 미디어를 보관하기 위한 저장소 요구량 : (30TB) * (365일) * (5년) = 약 55TB

### 개략적인 규모 추정 관련 팁

* 근사치를 활용한 계산
* 가정들을 적어 두기
* 단위를 붙이기
* 보통 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정한다.
