# Chapter 6 : 빈 라이프사이클과 범위

## 컨테이너 초기화와 종료

* 스프링 컨테이너는 초기화와 종료라는 라이프사이클을 갖는다.
  
* AnnotationConfigApplicationContext의 생성자를 이용해 컨텍스트 객체를 생성하는데, 이 시점에 스프링 컨테이너를 초기화한다.
  * 컨테이너 초기화가 완료되면 컨테이너를 사용할 수 있다.
  * 컨테이너를 사용한다는 것은 getBean()과 같은 메서드를 이용해 컨테이너에 보관된 빈 객체를 구한다는 것을 뜻한다.
  
* 컨테이너 사용이 끝나면 컨테이너를 종료한다.
  * 컨테이너 종료 시 close() 메서드를 사용한다.
  * close() 메서드는 AbstractApplicationContext 클래스에 정의되어 있고, 이를 AnnotationConfigApplicationContext, GenericXmlApplicationContext가 상속받고 있다.
  
## 스프링 빈 객체의 라이프사이클

* 빈 객체의 라이프사이클 : 객체 생성 -> 의존 설정 -> 초기화 -> 소멸

* 스프링 컨테이너를 초기화할 때 가장 먼저 빈 객체를 생성하고 의존을 설정한다.
  * 의존 자동 주입을 통한 의존 설정이 이 시점에 수행된다.
* 모든 의존 설정이 완료되면 빈 객체의 초기화를 수행한다.
  * 빈 객체를 초기화하기 위해 스프링은 빈 객체의 지정된 메서드를 호출한다.
* 스프링 컨테이너를 종료하면 스프링 컨테이너는 빈 객체의 소멸을 처리한다.
  * 이때에도 지정한 메서드를 호출한다.
  
### 빈 객체의 초기화와 소멸 : 스프링 인터페이스

* 스프링 컨테이너는 빈 객체 초기화 및 소멸을 위해 빈 객체의 지정한 메서드를 호출한다.
  * 다음의 두 인터페이스에 메서드를 정의하고 있다.
  
```
// 인터페이스
org.springframework.beans.factory.InitializingBean
org.springframework.beans.factory.DisposableBean

// 인터페이스 내 메서드
public interface InitializingBean {
    void afterPropertiesSet() throws Exception;
}
public interface DisposableBean {
    void destroy() throws Exception;
}
```

* 빈 객체가 InitializingBean 인터페이스를 구현하면 스프링 컨테이너는 초기화 과정에서 빈 객체의 afterPropertiesSet() 메서드를 실행한다.
  * 빈 객체를 생성한 뒤에 초기화 과정이 필요하면 InitializingBean 인터페이스를 afterPropertiesSet() 메서드를 통해 구현하면 된다.
* 빈 객체가 DisposableBean 인터페이스를 구현하면 스프링 컨테이너는 소멸 과정에서 빈 객체의 destroy() 메서드를 실행한다.
  * 빈 객체의 소멸 과정이 필요하면 DisposableBean 인터페이스를 destroy() 메서드를 통해 구현하면 된다.

* 데이터베이스 커넥션 풀에서 초기화와 소멸 과정이 필요하다.
  * 커넥션 풀을 위한 빈 객체는 초기화 과정에서 데이터베이스 연결을 생성한다.
  * 컨테이너를 사용하는 동안 연결을 유지하고 빈 객체를 소멸할 때 사용 중인 데이터베이스 연결을 끊어야 한다.
* 채팅 클라이언트에도 초기화와 소멸 과정이 필요하다.
  * 서버와의 연결을 생성하고 끊는 작업을 초기화 시점과 소멸 시점에 수행해야 한다.
  
### 빈 객체의 초기화와 소멸 : 커스텀 메서드

* 직접 구현한 클래스가 아닌 외부에서 제공받은 클래스를 스프링 빈 객체로 설정하고 싶은 경우 소스 코드를 받지 않았다면 위의 두 인터페이스를 구현하도록 수정할 수 없다.
  * 이러한 경우 스프링 설정에서 직접 메서드를 지정할 수 있다.

* @Bean 태그에서 initMethod 속성과 destroyMethod 속성을 사용해서 초기화 메서드와 소멸 메서드의 이름을 지정하면 된다.
  * 단, initMethod와 destroyMethod 속성에 지정한 메서드는 파라미터가 없어야 한다.

* 설정 클래스 자체는 자바 코드이므로 initMethod 속성을 사용하는 대신 설정 메서드에서 직접 초기화를 수행해도 된다.
  * 단, 초기화 메서드가 두 번 불리지 않도록 주의한다.
  
## 빈 객체의 생성과 관리 범위

* 별도 설정을 하지 않으면 빈은 싱글톤 범위를 갖는다.
  * 싱글톤 범위를 명시적으로 지정하고 싶으면 @Scope 애노테이션 값으로 "singleton"을 주면 된다.

* 프로토타입 범위의 빈을 설정할 수도 있다.
  * 빈의 범위를 프로토타입으로 지정하면 빈 객체를 구할 때마다 매번 새로운 객체를 생성한다.
  * 특정 빈을 프로토타입 범위로 지정하려면 값으로 "prototype"을 갖는 @Scope 애노테이션을 @Bean 애노테이션과 함께 사용한다.
  
* 프로토타입 범위를 갖는 빈은 완전한 라이프사이클을 따르지 않는다.
  * 빈 객체 생성, 프로퍼티 설정, 초기화 작업까지는 수행하지만 컨테이너를 종료한다고 해서 생성한 프로토타입 빈 객체의 소멸 메서드를 실행하지는 않는다.
  * 따라서 프로토타입 범위의 빈을 사용할 때는 빈 객체의 소멸 처리를 코드에서 직접 해야 한다.