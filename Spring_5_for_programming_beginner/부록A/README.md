# 부록 A : 메이븐 기초 안내

## 메이븐 아키타입을 이용한 프로젝트 생성하기

* 메이븐 프로젝트 폴더와 pom.xml 파일을 처음부터 직접 생성해도 되지만 메이븐이 제공하는 아키타입을 사용하면 미리 정의된 폴더 구조와 기반이 되는 pom.xml 파일을 사용해서 메이븐 프로젝트를 생성할 수도 있다.
  * 아키타입을 이용해서 메이븐 프로젝트를 생성하려면 명령 프롬프트에서 다음 명령어를 실행하면 된다.
  ```
  mvn archetype:generate
  ```
  * 위 명령어 실행 시 프로젝트를 생성하는데 필요한 정보를 입력하라는 메시지가 단계적으로 뜨는데, 각 항목별로 알맞은 값을 입력하면 된다.
    * groupId : 프로젝트가 속하는 그룹 식별자. 회사, 본부 또는 단체를 의미하는 값을 입력한다. 패키지 형식으로 계층을 표현한다.
    * artifactId : 프로젝트 결과물의 식별자. 프로젝트나 모듈을 의미하는 값이 온다.
    * version : 결과물의 버전. 기본 값은 1.0-SNAPSHOT이다.
    * package : 생성할 패키지. 별도로 입력하지 않으면 groupId와 동일한 구조의 패키지를 생성한다.

## 메이븐 프로젝트의 기본 디렉토리 구조

* archetype: generate 골(goal)이 성공적으로 실행되면 artifactId에 입력한 값과 동일한 이름의 폴더가 생성된다.
* 메이븐 프로젝트의 주요 폴더
  * src/main/java : 자바 소스 파일이 위치한다.
  * src/main/resources : 프로퍼티나 XML 등 리소스 파일이 위치한다. 클래스패스에 포함된다.
  * src/main/webapp : 웹 어플리케이션 관련 파일이 위치한다.(WEB-INF 폴더, JSP 파일 등)
  * src/test/java : 테스트 자바 소스 파일이 위치한다.
  * src/test/resources : 테스트 과정에서 사용되는 리소스 파일이 위치한다. 테스트에 사용되는 클래스패스에 포함된다.

## 컴파일 해보기/테스트 실행해보기/패키지 해보기

* 소스 코드 컴파일을 위해서는 다음과 같은 명령어를 실행한다.
```
mvn compile
```
  * 컴파일된 결과는 target/classes 폴더에 생성된다.
* 테스트 클래스를 실행하고 싶다면 다음 명령어를 사용한다.
```
mvn test
```
  * 컴파일된 테스트 클래스는 target/test-classes 폴더에 생성되고 테스트 결과 리포트는 target/surefire-reports 폴더에 저장된다.
* 프로젝트를 패키징해서 결과물을 생성하고 싶다면 다음 명령어를 실행한다.
```
mvn package
```
  * 위 명령어가 성공적으로 실행되면 target 폴더에 프로젝트 이름과 버전에 따라 알맞은 이름을 갖는 jar 파일이 생성된다.((projectName)-(version).jar)

## POM 파일 기본

* pom.xml 파일은 Project Object Model 정보를 담고 있는 파일로, 이 파일에서 다루는 주요 설정 정보는 다음과 같다.
  * 프로젝트 정보 : 프로젝트의 이름, 개발자 목록, 라이센스 등의 정보를 기술
  * 빌드 설정 : 소스, 리소스, 라이프 사이클별 실행할 플러그인 등 빌드와 관련된 설정을 기술
  * 빌드 환경 : 사용자 환경별로 달라질 수 있는 프로파일 정보를 기술
  * POM 연관 정보 ; 의존 프로젝트(모둘), 상위 프로젝트, 포함하고 있는 하위 모듈 등을 기술
* POM 파일에서 프로젝트 정보를 기술하는 태그
  * \<name\> : 프로젝트 이름
  * \<url\> : 프로젝트 사이트 URL
* POM 연관 정보는 프로젝트 간 연관 정보를 기술하며 관련 태그는 다음과 같다.
  * \<groupId\> : 프로젝트의 그룹 ID 설정
  * \<artifactId\> : 프로젝트의 artifact id 설정
  * \<version\> : 버전 설정
  * \<packaging\> : 패키징 타입 설정. jar로 설정하면 프로젝트의 결과가 jar 파일로 생성됨을 의미한다. 웹 어플리케이션을 위한 war 타입도 존재한다.
  * \<dependencies\> : 이 프로젝트에서 의존하는 다른 프로젝트 정보를 기술
    * \<dependency\> : 의존하는 프로젝트 POM 정보를 기술
      * \<groupId\> : 의존하는 프로젝트의 그룹 ID
      * \<artifactId\> : 의존하는 프로젝트의 artifact id
      * \<version\> : 의존하는 프로젝트의 버전
      * \<scope\> : 의존하는 범위를 설정

## 의존 설정

* 메이븐을 사용하면 코드에서 직접 사용하는 모듈에 대한 의존만 추가하면 된다.
  * 메이븐은 직접 사용하는 모듈뿐만 아니라 이 모듈이 의존하는 라이브러리를 자동으로 처리해준다.
  * 메이븐은 모듈을 다운로드 받을 때 관련 POM 파일도 함께 다운로드받는다. 그리고 POM 파일에 명시한 의존 모듈을 함께 다운로드받는다.
  * 이런 식으로 반복해서 다운로드받은 모듈이 필요로 하는 모듈을 다운로드받고 이들 모듈을 현재 프로젝트에서 사용할 클래스패스에 추가해준다.
* 따라서 개발자는 일일이 필요한 모듈을 다운로드받을 필요가 없다.
  * 현재 코드가 직접 필요로 하는 모듈만 \<dependency\>에 추가하면 나머지 의존은 모두 메이븐이 알맞게 처리해준다.

* search.maven.org를 통해 메이븐 중앙 리포지토리에 등록된 POM 정보를 검색할 수 있다.
  * 이 사이트를 통해 추가할 라이브러리의 \<dependency\> 설정 정보를 구할 수 있다.

* \<scope\>는 의존하는 모듈이 언제 사용되는지를 설정한다.
  * compile : 컴파일할 떄 필요. 테스트 및 런타임에도 클래스패스에 포함된다. 기본값.
  * runtime : 런타임에 필요. JDBC 드라이버 등이 예가 된다. 배포시 포함된다.
  * provided : 컴파일할 때 필요하지만 실제 런타임 때는 컨테이너 같은 것에서 기본으로 제공되는 모듈임을 의미한다. 서블릿이나 JSP API 등이 이에 해당한다. 배포시 제외된다.
  * test : 테스트 코드를 컴파일할 때 필요. Mock 테스트를 위한 모듈이 예이다. 테스트 시에 클래스패스에 포함된다. 배포시 제외된다.

## 원격 리포지토리와 로컬 리포지토리

* 메이븐은 컴파일이나 패키징 등 작업을 실행할 때 필요한 플러그인이나 pom.xml 파일의 \<dependency\>에 설정한 모듈을 메이븐 중앙 리포지토리에서 다운로드받는다.
* 원격 리포지토리에서 다운로드받은 모듈은 로컬 리포지토리에 저장된다.
  * 로컬 리포지토리는 [USER_HOME]/.m2/repository 폴더에 생성된다.
  * 로컬 리포지토리에 [groupId]/[artifactId]/[version] 형식의 폴더를 생성한 뒤 다운로드받은 모듈을 저장한다.
  * 이 폴더에는 패키징된 모듈 파일, pom 파일, 소스 코드 다운로드 옵션을 실행한 경우 소스 코드를 포함한 jar 파일이 포함된다.
* 일단 원격 리포지토리로부터 파일을 다운로드해서 로컬 리포지토리에 저장하면 그 뒤로는 로컬 리포지토리에 저장된 파일을 사용한다.

## 메이븐 라이프사이클과 플러그인 실행

* 메이븐은 프로젝트의 빌드 라이프사이클을 제공한다.
  * 크게 clean, build(default), site의 세 가지 라이프사이클을 제공한다.
  * 각 라이프사이클은 순서를 갖는 단계로 구성된다.
  * 또한 각 단계별로 실행할 플러그인 골이 정의되어 있어서 각 단계마다 알맞은 작업을 실행한다.
* 라이프사이클의 특정 단계를 실행하려면 mvn [단계이름] 명령어를 실행하면 된다.
* 라이프사이클의 특정 단계를 실행하면 그 단계의 앞에 위치한 모든 단계를 실행한다.
