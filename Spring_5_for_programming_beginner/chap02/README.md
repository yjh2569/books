# Chapter 2 : 스프링 시작하기

## Maven

* 메이븐 프로젝트에서 핵심은 pom.xml 파일이다.
  * 모든 메이븐 프로젝트는 프로젝트의 루트 폴더에 pom.xml 파일을 갖는다.
  * pom.xml은 메이븐 프로젝트에 대한 설정 정보를 관리하는 파일로서 프로젝트에서 필요로 하는 의존 모듈이나 플러그인 등에 대한 설정을 담는다.
  
### 메이븐 의존 설정

```
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context</artifactId>
    <version>5.0.2.RELEASE</version>
</dependency>
```

* 메이븐은 한 개의 모듈을 아티팩트라는 단위로 관리한다.
  * 위 설정은 spring-context라는 식별자를 가진 5.0.2.RELEASE 버전의 아티팩트에 대한 의존을 추가한 것이다.
  * 의존을 추가한다는 것은 일반적인 자바 어플리케이션에서 클래스 패스에 spring-context 모듈을 추가한다는 것을 뜻한다.
  * 각 아티팩트의 완전한 이름은 "아티팩트이름-버전.jar"이므로, 위 설정은 메이븐 프로젝트의 소스 코드를 컴파일하고 실행할 때 사용할 클래스 패스에 spring-context-5.0.2.RELEASE.jar 파일을 추가한다는 것을 의미한다.
  
### 메이븐 리포지토리

* 클래스 패스에 아티팩트 jar 파일을 추가하려면 파일 시스템에 어딘가에 이 파일이 존재해야 한다.

* 메이븐은 코드를 컴파일하거나 실행할 때 \<dependency\>로 설정한 아티팩트 파일을 사용한다. 
* 이때 아티팩트 파일을 구하기 위해 원격 리포지토리 혹은 로컬 리포지토리를 이용한다.
  * 메이븐 로컬 리포지토리에서 그룹id\아티팩트id\버전 폴더에 아티팩트id-버전.jar 형식의 이름을 갖는 파일이 있는지 검사하고, 파일이 존재하면 그 파일을 사용한다.
  * 로컬 리포지토리에 파일이 없으면 메이븐 원격 중앙 리포지토리로부터 해당 파일을 다운로드해 로컬 리포지토리에 복사한 뒤 그 파일을 사용한다.
  
* 메이븐은 기본적으로 사용자홈폴더\.m2\repository 폴더를 로컬 리포지토리로 사용한다.
* 예를 들어 위와 같이 의존 설정을 한 경우 아티팩트 파일은 사용자홈폴더\.m2\repository\org\springframework\spring-context\5.0.2.RELEASE에 존재한다.

* 명령 프롬프트에서 프로젝트 폴더로 이동한 뒤 'mvn compile' 명령을 실행하면 처음에는 원격 리포지토리를 통해 아티팩트 파일을 가져오고, 그 이후로는 로컬 리포지토리에 있는 파일을 가져온다.

### 의존 전이

* 앞서 'mvn compile'을 실행할 때 원했던 아티팩트 파일 외에 다양한 아티팩트 파일을 다운로드하는 것을 볼 수 있다.
  * 이 파일에는 컴파일을 수행하는데 필요한 메이븐 컴파일러 플러그인과 같이 메이븐과 관련된 파일이 포함된다.
  * 추가로 의존에서 설정한 아티팩트가 다시 의존하는 파일도 포함된다.
* 의존 전이 : 메이븐은 의존하는 대상뿐만 아니라 의존 대상이 다시 의존하는 대상도 함께 다운로드한다.

### 메이븐 기본 폴더 구조

* src\main\java 폴더에는 자바 소스 코드가 위치한다.
* src\main\resources 폴더에는 XML이나 프로퍼티 파일과 같이 자바 소스 이외의 다른 자원 파일이 위치힌다.
* 두 폴더 모두 프로젝트 소스로 사용되므로 이클립스에서 메이븐 프로젝트를 임포트하면 두 폴더 모두 이클립스의 소스 폴더가 된다.
* 웹 어플리케이션을 개발할 때는 src\main\webapp 폴더를 웹 어플리케이션 기준 폴더로 사용한다.
  * 이 폴더를 기준으로 JSP 소스 코드나 WEB-INF\web.xml 파일 등을 작성해서 넣는다.

## Gradle

* 그레이들 프로젝트를 생성하는 과정은 메이븐과 크게 다르지 않다.
  * 차이점이라면 pom.xml 대신 build.gradle 파일을 작성하는 것뿐이다.
  * 폴더 구조도 동일하다.

* gradlew.bat 파일과 gradlew 파일은 각각 윈도우와 리눅스에서 사용할 수 있는 실행 파일로 gradle 명령어 대신 사용할 수 있는 래퍼 파일이다.
  * 이 래퍼 파일을 사용하면 그레이들 설치 없이 그레이들 명령어를 실행할 수 있다.
  * 소스 코드를 공유할 때 gradle wrapper 명령어로 생성한 두 파일과 gradle 폴더를 공유하면 그레이들을 설치하지 않은 개발자도 생성한 래퍼 파일을 이용해서 그레이들 명령어를 실행할 수 있다.
  * gradlew compileJava 명령어로 실행할 수 있다.
  
## 예제 코드 작성

* @Configuration : 해당 클래스를 스프링 설정 클래스로 지정한다.

* 스프링은 객체를 생성하고 초기화하는 기능을 제공한다.
  * 스프링이 생성하는 객체를 빈 객체라고 부른다.
  * @Bean 애노테이션을 메서드에 붙이면 해당 메서드가 생성한 객체를 스프링이 관리하는 빈 객체로 등록한다.
  * @Bean 애노테이션을 붙인 메서드의 이름은 빈 객체를 구분할 때 사용한다. 스프링이 생성한 객체를 구분할 때 이름을 사용한다.
  * @Bean 애노테이션을 붙인 메서드는 객체를 생성하고 알맞게 초기화해야 한다.

* AnnotationConfigApplicationContext 클래스는 자바 설정에서 정보를 읽어와 빈 객체를 생성하고 관리한다. 
  * 이 클래스의 객체를 생성할 때 앞서 작성한 AppContext 클래스를 생성자 파라미터로 전달한다.
  * 그러면 AppContext에 정의한 @Bean 설정 정보를 읽어와 Greeter 객체를 생성하고 초기화한다.
  * getBean() 메서드는 이 클래스가 자바 설정을 읽어와 생성한 빈 객체를 검색할 때 사용한다.
    * 첫 번째 파라미터는 @Bean 애노테이션의 메서드 이름인 빈 객체의 이름이며, 두 번째 파라미터는 검색할 빈 객체의 타입이다.

## 스프링은 객체 컨테이너

* 스프링의 핵심 기능은 객체를 생성하고 초기화하는 것이다.
  * 이와 관련된 기능은 ApplicationContext라는 인터페이스에 정의되어 있다.
  * AnnotationConfigApplicationContext 클래스는 이 인터페이스를 알맞게 구현한 클래스 중 하나다.
    * 자바 클래스에서 정보를 읽어와 객체 생성과 초기화를 수행한다.
    
* BeanFactory 인터페이스
  * 객체 생성과 검색에 대한 기능을 정의한다.
  * getBean() 메서드가 여기에 정의되어 있다.
  * 싱글톤/프로토타입 빈인지 확인하는 기능도 제공한다.
  
* ApplicationContext 인터페이스
  * 메시지, 프로필/환경 변수 등을 처리할 수 있는 기능을 추가로 정의한다.

* AnnotationConfigApplicationContext : 자바 애노테이션을 이용한 클래스로부터 객체 설정 정보를 가져온다.
* GenericXmlApplicationContext : XML로부터 객체 설정 정보를 가져온다.
* GenericGroovyApplicationContext : 그루비 코드를 이용해 설정 정보를 가져온다.

* 위 3가지 클래스 중 어떤 구현 클래스를 사용하든 각 구현 클래스는 설정 정보로부터 빈 객체를 생성하고 그 객체를 내부에 보관한다.
  * getBean() 메서드를 실행해 해당하는 빈 객체를 제공한다.
  
* ApplicationContext(또는 BeanFactory)는 빈 객체의 생성, 초기화, 보관, 제거 등을 관리하고 있어서 스프링 컨테이너라고도 부른다.
  * 스프링 컨테이너는 내부적으로 빈 객체와 빈 이름을 연결하는 정보를 갖는다.
  * 이름과 실제 객체의 관계뿐만 아니라 실제 객체의 생성, 초기화, 의존 주입 등 객체 관리를 위한 다양한 기능을 제공한다.
  
### 싱글톤 객체

* 별도 설정을 하지 않으면 스프링은 한 개의 빈 객체를 생성하며, 이때 빈 객체는 싱글톤 범위를 갖는다고 표현한다.
  * 스프링은 기본적으로 한 개의 @Bean 애노테이션에 대해 한 개의 빈 객체를 생성한다.