# Chapter 4 : 의존 자동 주입

## @Autowired 애노테이션을 이용한 의존 자동 주입

* 자동 주입 기능을 사용하면 스프링이 알아서 의존 객체를 찾아서 주입한다.

* 자동 주입 기능을 사용하려면 의존을 주입할 대상에 @Autowired 애노테이션을 붙이기만 하면 된다.
  * @Autowired 애노테이션을 붙이면 설정 클래스에서 의존을 주입하지 않아도 된다.
  * 필드에 @Autowired 애노테이션이 붙어 있으면 스프링이 해당 타입의 빈 객체를 찾아서 필드에 할당한다.
  * 빈 객체의 메서드에 @Autowired 애노테이션이 붙어 있으면 스프링은 해당 메서드를 호출한다. 이때 메서드 파라미터 타입에 해당하는 빈 객체를 찾아 인자로 주입한다.
  * 즉, @Autowired 애노테이션을 필드나 세터 메서드에 붙이면 스프링은 타입이 일치하는 빈 객체를 찾아서 주입한다.
  
### 일치하는 빈이 없는 경우

* @Autowired 애노테이션을 적용한 대상에 일치하는 빈이 없는 경우
* 혹은 @Autowired 애노테이션을 붙인 주입 대상에 일치하는 빈이 두 개 이상인 경우
  * UnsatisfiedDependencyException이 발생한다.
  
* 자동 주입을 하려면 해당 타입을 가진 빈이 어떤 빈인지 정확하게 한정할 수 있어야 한다.

## Qualifier 애노테이션을 이용한 의존 객체 선택

* 자동 주입 가능한 빈이 두 개 이상인 경우 @Qualifier 애노테이션을 사용한다.
  * @Qualifier 애노테이션을 사용하면 자동 주입 대상 빈을 한정할 수 있다.

* @Bean 애노테이션을 붙인 빈 설정 메서드에서 사용한 뒤, @Autowired 애노테이션에서 자동 주입할 빈을 한정할 때 사용한다.
  * @Qualifier("빈이름")을 통해 해당 빈의 한정 값으로 "빈이름"을 사용하고, @Autowired 애노테이션에서 자동 주입할 빈을 한정할 때 이 값을 활용한다.
  
* @Qualifier 애노테이션도 @Autowired 애노테이션과 마찬가지로 필드와 메서드에 적용할 수 있다.

### 빈 이름과 기본 한정자

* 빈 설정에 @Qualifier 애노테이션이 없으면 빈의 이름을 한정자로 지정한다.
* @Autowired 애노테이션도 @Qualifier 애노테이션이 없으면 필드나 파라미터 이름을 한정자로 사용한다.

## 상위/하위 타입 관계와 자동 주입

* 만약 어떤 클래스가 다른 클래스를 상속하고 있고, 두 클래스 타입 빈이 주입된 상태라면 스프링 컨테이너는 @Autowired 애노테이션 태그를 만났을 때 어떤 클래스 타입 빈을 주입해야 할지를 알 수가 없어 예외가 발생한다.
  * 따라서 어떤 빈을 주입할지 결정해야 한다.
  * 이를 위해 @Qualifier 애노테이션을 사용하거나, 상위 클래스가 아닌 하위 클래스를 사용하도록 수정한다.
  
## @Autowired 애노테이션의 필수 여부

* @Autowired 애노테이션은 기본적으로 @Autowired 애노테이션을 붙인 타입에 해당하는 빈이 존재하지 않으면 예외를 발생시킨다.
  * 따라서 자동 주입할 대상이 필수가 아닌 경우에는 @Autowired 애노테이션의 required 속성을 false로 지정하면 된다.
  * required 속성이 false면 매칭되는 빈이 없어도 예외가 발생하지 않고 자동 주입을 수행하지 않는다.

* 스프링 5 버전부터는 의존 주입 대상에 자바 8의 Optional을 사용해도 된다.
  * 자동 주입 대상 타입이 Optional인 경우, 일치하는 빈이 존재하지 않으면 값이 없는 Optional을 인자로 전달하고, 일치하는 빈이 존재하면 해당 빈을 값으로 갖는 Optional을 인자로 전달한다.
  * Optional을 사용하는 코드는 값 존재 여부에 따라 알맞게 의존 객체를 사용하면 된다.
  
* @Nullable 애노테이션을 사용해 필수 여부를 지정할 수도 있다.
  * @Autowired 애노테이션을 붙인 setter 메서드에서 @Nullable 애노테이션을 의존 주입 대상 파라미터에 붙이면 스프링 컨테이너는 setter 메서드를 호출할 때 자동 주입할 빈이 존재하면 해당 빈을 인자로 전달하고, 존재하지 않으면 인자로 null을 전달한다.
  * required 속성을 false로 하는 경우 대상 빈이 존재하지 않으면 setter 메서드를 호출하지 않고, @Nullable 애노테이션을 사용한 경우 자동 주입할 빈이 존재하지 않아도 메서드가 호출된다.
  
* 앞의 세 가지 방식은 필드에도 그대로 적용된다.

* 기본 생성자에서 자동 주입 대상이 되는 필드 초기화 시 유의 사항
  * @Autowired 애노테이션의 required 속성이 false이면 일치하지 빈이 존재하지 않을 때 자동 주입 대상이 되는 필드나 메서드에 null을 전달하지 않는다.
  * @Nullable 애노테이션을 사용할 경우 스프링 컨테이너는 의존 주입 대상이 존재하지 않으면 null을 값으로 전달한다.
    * 스프링 컨테이너는 빈을 초기화하기 위해 기본 생성자를 이용해서 객체를 생성한 뒤, 의존 자동 주입을 처리하기 위해 setter 메서드를 호출한다.
    * 따라서 기본 생성자에서 별도의 빈 객체가 없는 필드를 기본 생성자에서 초기화해도 setter 메서드가 null을 전달받게 되어 해당 필드가 다시 null로 바뀐다.
  * Optional 타입은 매칭되는 빈이 없으면 값이 없는 Optional을 할당한다.

## 자동 주입과 명시적 의존 주입 간의 관계

* 설정 클래스에서 setter 메서드를 통해 의존을 명시적으로 주입해도 해당 setter 메서드에 @Autowired 애노테이션이 붙어 있으면 자동 주입을 통해 일치하는 빈을 주입한다.
  * 따라서 @Autowired 애노테이션을 사용했다면 설정 클래스에서 객체를 명시적으로 주입하기보다는 스프링이 제공하는 자동 주입 기능을 사용하는 편이 낫다.