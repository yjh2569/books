# 타임리프 연동

## 타임리프 개요

* 타임리프(Thymeleaf)는 템플릿 엔진으로, 웹을 염두하고 설계해서 HTML 템플릿을 만들 때 적합하다.
  * 자바스크립트와 CSS에 적합한 템플릿도 만들 수 있다.

### 타임리프의 주요 식

* 타임리프는 크게 변수 식, 메시지 식, 링크 식의 세 가지 식과 변수 식을 제공한다.
  * 변수 식 : ${OGNL}
  * 메시지 식 : #{코드}
  * 링크 식 : @{링크}
  * 선택 변수 식 : *{OGNL}
* 타임리프에는 템플릿을 변환할 때 필요한 데이터를 가진 컨텍스트가 존재하는데 변수명을 사용해서 이 컨텍스트에 보관된 객체에 접근한다.
  * 스프링 MVC 연동을 할 경우 컨트롤러에서 생성한 모델 속성 이름이 변수명이 된다.
* 메시지 식은 외부 메시지 자원에서 코드에 해당하는 문자열을 읽어와 출력한다.
  * 지정한 경로에 위치한 프로퍼티 파일을 메시지 자원으로 사용한다.
  * 스프링 MVC 연동을 하면 \<spring:message\>와 동일하게 스프링이 제공하는 MessageSource로부터 코드에 해당하는 메시지를 읽어온다.
* 링크 식은 링크 문자열을 생성한다.
  * 링크 식이 절대 경로면 JSTL의 \<c:url\> 태그와 동일하게 웹 어플리케이션 컨텍스트 경로를 기준으로 링크를 생성한다.
  * 링크의 일부를 식으로 변경하고 싶다면 경로에 {변수}를 사용할 수 있다. 이때 경로 변수에 넣은 값은 뒤에 붙인 괄호 안에 지정한다.
* 선택 변수식은 th:object 속성과 관련되어 있다. 이 속성은 특정 객체를 선택하는데 선택 변수식은 th:object로 선택한 객체를 기준으로 나머지 경로를 값으로 사용한다.

### 타임리프가 제공하는 주요 속성

* 다음 두 속성은 태그의 몸체에 원하는 값을 출력한다.
  * th:text : 식의 값을 태그 몸체로 출력한다. '<'나 '&'와 같은 HTML 특수 문자를 '&lt;'과 '&amp;'와 같은 엔티티 형식으로 변환한다.
  * th:utext : 위와 동일하나 '<'나 '&'와 같은 HTML 특수 문자를 그대로 출력한다.
* th:href : \<a\> 태그의 href 속성을 지정한다.
* th:action : \<form\> 태그의 action 속성 값을 치환한다.
* th:value : \<input\> 태그와 같은 폼 관련 태그의 value 속성을 지정한다.
* th:each : 반복 처리

### 타임리프 식 객체

* 타임리프는 식에서 사용할 수 있는 객체를 제공한다.
  * 이 식 객체를 이용하면 문자열 처리나 날짜 형식 변환 등의 작업을 할 수 있다.
  * "#객체명"을 사용해서 식 객체를 사용한다.
* 타임리프가 제공하는 주요 식 객체
  * #strings : 문자열 비교, 문자열 추출 등 String 타입 위한 기능 제공
  * #numbers : 포맷팅 등 숫자 타입 위한 기능 제공
  * #dates, #calendars : Date 타입과 Calendar 타입을 위한 기능 제공
  * #lists, #sets, #maps : List, Set, Map 타입을 위한 기능 제공

## 스프링 MVC와 타임리프 연동 설정

* 스프링 MVC에서 타임리프가 제공하는 ViewResolver를 사용하도록 설정하면 결과를 타임리프 템플릿을 이용해서 생성할 수 있다.
  * 스프링 MVC와 타임리프를 연동하려면 타임리프의 스프링 연동 모듈인 thymeleaf-spring5(와 thymeleaf-extras-java8time)을 추가해야 한다.
  * 의존을 추가했다면 스프링 MVC가 타임리프를 사용하도록 ViewResolver를 설정한다.

### 스프링 MVC 폼과 에러 메시지 연동

* JSP가 \<form:form\> 태그를 이용해서 커맨드 객체와 폼을 연동하는 것처럼 타임리프도 몇 가지 속성과 식 객체를 이용해서 폼을 연동할 수 있다.
* th:field 속성은 폼에 표시할 커맨드 객체의 프로퍼티를 지정한다.
  * 이 속성은 스프링의 ConversionService를 이용해서 해당 값을 알맞게 변환한다.
* #fields는 스프링 MVC를 위한 식 객체로 Errors와 연관되어 있다.
  * #fields 식 객체가 제공하는 메서드를 이용해서 에러 정보에 접근할 수 있다.
  * 예를 들어 #fields.errors(프로퍼티)는 특정 프로퍼티에 해당하는 에러 메시지 목록을 반환한다.

### 스프링 부트와 타임리프 연동 설정

* 스프링 부트에서는 타임리프를 위한 starter 모듈을 의존으로 추가하면 끝난다.
  * 스프링 부트는 기본으로 src/main/resources/templates 폴더에서 타임리프 템플릿 파일을 검색한다.
